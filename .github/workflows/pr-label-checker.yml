name: Check PR Labels

on:
  pull_request:
    types: [opened, edited, labeled, unlabeled, synchronize, reopened]

permissions:
  pull-requests: read
  checks: write

jobs:
  check-labels:
    runs-on: ubuntu-latest
    steps:
      - name: Verify Version Labels
        uses: actions/github-script@v7
        with:
          script: |
            const labels = context.payload.pull_request.labels.map(l => l.name);
            const versionLabels = ['patch', 'minor', 'major'];
            const foundVersionLabels = labels.filter(l => versionLabels.includes(l));
            
            // Verifica che ci sia esattamente una label di versione
            if (foundVersionLabels.length === 0) {
              core.setFailed('‚ùå Per favore, aggiungi UNA label di versione: patch (fix/bugfix), minor (feature), o major (breaking change)');
            } else if (foundVersionLabels.length > 1) {
              core.setFailed(`‚ö†Ô∏è Trovate multiple label di versione: ${foundVersionLabels.join(', ')}. Per favore, mantieni solo UNA label.`);
            } else {
              const label = foundVersionLabels[0];
              let emoji = 'üêõ';
              let description = 'fix/bugfix';
              
              if (label === 'minor') {
                emoji = '‚ú®';
                description = 'feature/enhancement';
              } else if (label === 'major') {
                emoji = 'üí•';
                description = 'breaking change';
              }
              
              console.log(`‚úÖ Label di versione valida: ${emoji} ${label} (${description})`);
              core.notice(`Version bump: ${label} - ${description}`);
            }
